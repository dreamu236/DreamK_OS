# 운영 워크플로우 (MVP)

## 목적
Director(원장) 1인이 Google Sheets에서 **입력 최소화 / 누락 없는 실행 / 체크 기반 완료**를 달성하기 위한 표준 워크플로우를 정의한다.

## 공통 원칙
- 이벤트 중심: `CHILD` 변경이 `TASKS` 생성의 트리거가 된다.
- 수동 확정 우선: MVP에서는 자동 완료 대신 원장 수동 체크를 기본으로 한다.
- 단일 출처: 원아 상태는 `CHILD.state`, 실행 상태는 `TASKS.status`를 기준으로 본다.

---

## Workflow A — 입학확정

### 시작 조건
- `CHILD.admission_confirmed = TRUE`
- `CHILD.admission_date`가 입력됨

### 실행 단계
1. 원장이 `CHILD` 시트에서 입학확정 체크를 한다.
2. 자동화 트리거가 동작하여 `TASKS`에 입학확정 기본 6개 TASK를 생성한다.
3. 원장은 `TASKS` 필터뷰(`status=대기`)에서 대상 원아 업무를 순서대로 처리한다.
4. `명단` TASK 처리 시 `ROSTER`에 원아를 반에 배치한다.
5. `안내문자` TASK 처리 시 `sms_status`를 `예약` 또는 `발송완료`로 변경한다.
6. 각 TASK 완료 시 `status=완료`, `completed_at` 기록.

### 종료 조건
- 입학확정 관련 TASK 6개가 모두 `완료`
- `CHILD.state`가 `재원`으로 유지

---

## Workflow B — 상담(정기/수시)

### 시작 조건
- `TASKS.related_event`가 `정기상담(4월)`, `정기상담(10월)`, `수시상담` 중 하나

### 실행 단계
1. 상담 일정확정 TASK 생성 (`정기상담-일정확정` 또는 `수시상담-일정확정`).
2. 일정이 확정되면 해당 TASK 완료 처리.
3. 상담 진행 후 기록완료 TASK(`정기상담-기록완료` 또는 `수시상담-기록완료`)를 완료 처리.

### 종료 조건
- 해당 상담 이벤트의 일정확정/기록완료 TASK가 모두 `완료`

---

## Workflow C — 진급(3/1)

### 시작 조건
- 매년 3월 1일 운영 이벤트 발생

### 실행 단계
1. 진급 이벤트 TASK(`진급-반배정`) 생성.
2. 원장이 `CLASS_ASSIGNMENT`에 신규 배정 이력 입력 (`reason=진급`).
3. `CHILD.current_class` 최신화.
4. 필요 시 `ROSTER` 재정렬/갱신.
5. 진급 TASK 완료 처리.

### 종료 조건
- 대상 원아의 반배정 이력이 누락 없이 반영
- `진급-반배정` TASK 완료

---

## Workflow D — 퇴소

### 시작 조건
- 원아 퇴소 확정

### 실행 단계
1. `CHILD.state`를 `퇴소`로 변경.
2. 환불/정산 TASK(`환불-정산`) 생성 및 처리.
3. 필요 시 증서 번호 입력 TASK(`증서-번호입력`) 처리.
4. 명단/출력 대상에서 제외 처리.

### 종료 조건
- 퇴소 후속 TASK 완료
- 운영상 필요 장부 반영 완료

---

## 일일 운영 루틴 (권장)
1. 오전: `TASKS`에서 `대기 TASK` 필터 확인
2. 정오: `안내문자 TASK`의 발송 예정/완료 상태 점검
3. 마감 전: `status=완료 AND completed_at is blank` 누락 점검
4. 주 1회: `CLASS_ASSIGNMENT`와 `CHILD.current_class` 정합성 점검
